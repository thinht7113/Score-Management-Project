<!doctype html>
<html lang="vi" data-bs-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin ¬∑ Score Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{{ url_for('admin_ui.static', filename='css.css') }}" rel="stylesheet">
</head>
<body>
  <!-- Topbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm sticky-top">
    <div class="container-fluid">
      <button class="btn btn-outline-primary me-2 d-lg-none" id="btnNav" aria-label="M·ªü/ƒë√≥ng menu">
        <i class="bi bi-list"></i>
      </button>

      <a class="navbar-brand d-flex align-items-center gap-2" href="#" aria-label="Trang ch·ªß Admin">
        <i class="bi bi-mortarboard-fill"></i>
        <span>Admin</span>
      </a>

      <div class="ms-auto d-flex align-items-center gap-3">
        <span id="themeLabel" class="text-muted small d-none d-sm-inline">Theme: auto</span>
        <button id="btnTheme" class="btn btn-outline-secondary btn-sm"><i class="bi bi-moon-stars"></i> ƒê·ªïi theme</button>
        <span id="whoami" class="text-body-secondary small d-none d-md-inline">‚Äî</span>
        <button id="btnLogin" class="btn btn-primary btn-sm"><i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng nh·∫≠p</button>
        <button id="btnLogout" class="btn btn-outline-secondary btn-sm"><i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t</button>
      </div>
    </div>
  </nav>

  <!-- Main layout -->
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <aside class="col-lg-3 col-xl-2 sidebar border-end">
        <div class="p-3">
          <div class="fw-bold text-uppercase small text-secondary mb-2">Menu</div>
          <div id="menu" class="nav flex-column gap-1">
            <a href="#" class="nav-link active" data-page="page-dashboard"><i class="bi bi-speedometer2 me-2"></i>B·∫£ng ƒëi·ªÅu khi·ªÉn</a>
            <a href="#" class="nav-link" data-page="page-import"><i class="bi bi-upload me-2"></i>Nh·∫≠p d·ªØ li·ªáu</a>
            <a href="#" class="nav-link" data-page="page-students"><i class="bi bi-people me-2"></i>Sinh vi√™n</a>
            <a href="#" class="nav-link" data-page="page-users"><i class="bi bi-person-gear me-2"></i>Ng∆∞·ªùi d√πng</a>
            <a href="#" class="nav-link" data-page="page-configs"><i class="bi bi-gear-wide-connected me-2"></i>C·∫•u h√¨nh</a>
            <a href="#" class="nav-link" data-page="page-warnings"><i class="bi bi-exclamation-triangle me-2"></i>C·∫£nh b√°o</a>
            <a href="#" class="nav-link" data-page="page-logs"><i class="bi bi-clock-history me-2"></i>Nh·∫≠t k√Ω</a>
            <a href="#" class="nav-link" data-page="page-catalog"><i class="bi bi-journal-text me-2"></i>Danh m·ª•c</a>
          </div>
        </div>
      </aside>

      <!-- Content -->
      <main class="col-lg-9 col-xl-10 content p-3">
        <!-- Dashboard -->
        <section id="page-dashboard" class="page">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card glass"><div class="card-body">
                <div class="text-secondary small">T·ªïng sinh vi√™n</div>
                <div class="display-6 fw-bold" id="kpiStudents">‚Äî</div>
              </div></div>
            </div>
            <div class="col-md-4">
              <div class="card glass"><div class="card-body">
                <div class="text-secondary small">T·ªïng h·ªçc ph·∫ßn</div>
                <div class="display-6 fw-bold" id="kpiCourses">‚Äî</div>
              </div></div>
            </div>
            <div class="col-md-4">
              <div class="card glass"><div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                  <div>
                    <div class="text-secondary small">T·ª∑ l·ªá qua</div>
                    <div class="display-6 fw-bold" id="kpiPassRate">‚Äî</div>
                  </div>
                  <span class="badge text-bg-primary">KPI</span>
                </div>
              </div></div>
            </div>
          </div>
        </section>

        <!-- Import -->
        <section id="page-import" class="page d-none">
          <div class="card">
            <div class="card-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-upload"></i><span>Nh·∫≠p d·ªØ li·ªáu</span>
                <span id="im_mode_badge" class="badge text-bg-secondary ms-2">Preview</span>
              </div>
              <div class="d-flex gap-2">
                <a id="dlRosterTpl" class="btn btn-outline-secondary btn-sm" href="#" download>üìÑ M·∫´u Roster</a>
                <a id="dlGradesTpl" class="btn btn-outline-secondary btn-sm" href="#" download>üìÑ M·∫´u B·∫£ng ƒëi·ªÉm</a>
              </div>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-xl-3 col-md-4">
                  <label class="form-label">Lo·∫°i nh·∫≠p</label>
                  <select id="im_kind" class="form-select">
                    <option value="grades">B·∫£ng ƒëi·ªÉm theo l·ªõp</option>
                    <option value="roster">Danh s√°ch l·ªõp (Roster)</option>
                    <option value="curriculum">Ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o (CTƒêT)</option>
                  </select>
                </div>
                <div class="col-xl-3 col-md-4">
                  <label class="form-label">L·ªõp</label>
                  <select id="im_class" class="form-select"><option value="">-- Ch·ªçn l·ªõp --</option></select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">H·ªçc k·ª≥</label>
                  <input id="im_semester" class="form-control" placeholder="VD: 2024-2025-1">
                </div>
                <div class="col-md-2">
                  <label class="form-label">Thi l·∫°i</label>
                  <select id="im_policy" class="form-select">
                    <option value="">M·∫∑c ƒë·ªãnh h·ªá th·ªëng</option>
                    <option value="keep-latest">Gi·ªØ l·∫ßn g·∫ßn nh·∫•t</option>
                    <option value="best">L·∫•y ƒëi·ªÉm cao nh·∫•t</option>
                  </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="im_allow_update">
                    <label class="form-check-label" for="im_allow_update">Cho ph√©p c·∫≠p nh·∫≠t</label>
                  </div>
                </div>

                <!-- Fuzzy toggle -->
                <div class="col-md-4">
                  <div class="form-check mt-2">
                    <input class="form-check-input" type="checkbox" id="im_apply_fuzzy">
                    <label for="im_apply_fuzzy" class="form-check-label">√Åp d·ª•ng kh·ªõp g·∫ßn (fuzzy) khi ghi</label>
                  </div>
                  <div class="input-group input-group-sm mt-1" style="max-width:200px">
                    <span class="input-group-text">Ng∆∞·ª°ng</span>
                    <input id="im_fuzzy_th" type="number" step="0.01" min="0.5" max="0.99" value="0.78" class="form-control">
                  </div>
                </div>

                <!-- Dropzone -->
                <div class="col-12">
                  <label class="form-label">File d·ªØ li·ªáu</label>
                  <div id="dropzone" class="dropzone">
                    <input id="im_file" type="file" class="form-control" style="display:none">
                    <div class="dz-invite">
                      <i class="bi bi-cloud-arrow-up"></i>
                      <div>K√©o th·∫£ file v√†o ƒë√¢y ho·∫∑c <button type="button" class="btn btn-sm btn-primary" id="pickFileBtn">Ch·ªçn file</button></div>
                      <div id="pickedName" class="text-muted small mt-1"></div>
                    </div>
                  </div>
                </div>

                <!-- Actions -->
                <div class="col-12 d-flex gap-2 sticky-actions">
                  <button id="btnPreview" class="btn btn-warning"><i class="bi bi-eye"></i> Preview</button>
                  <button id="btnCommit" class="btn btn-success"><i class="bi bi-check2-circle"></i> Ghi ch√≠nh th·ª©c</button>
                  <div id="im_progress" class="progress ms-auto" style="width:240px; display:none">
                    <div class="progress-bar" role="progressbar" style="width:0%"></div>
                  </div>
                </div>

                <!-- Result -->
                <div class="col-lg-4">
                  <div class="card h-100 glass"><div class="card-header">T√≥m t·∫Øt</div>
                    <div class="card-body" id="im_summary">‚Äî</div>
                  </div>
                </div>
                <div class="col-lg-8">
                  <div class="card h-100 glass"><div class="card-header">Preview</div>
                    <div class="card-body" id="im_preview_table"></div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="card glass"><div class="card-header">C·∫£nh b√°o / L·ªói</div>
                    <div class="card-body" id="im_issues"><span class="text-success">Kh√¥ng c√≥ c·∫£nh b√°o.</span></div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </section>

        <!-- Students / Users / Configs / Warnings / Logs / Catalog -->
        <!-- (gi·ªØ IDs & c·∫•u tr√∫c ƒë·ªÉ JS ho·∫°t ƒë·ªông; giao di·ªán card ƒë√£ ƒë·∫πp h∆°n) -->
        <section id="page-students" class="page d-none">
          <div class="card glass">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-people me-2"></i>Sinh vi√™n</span>
              <button id="btnAddStudent" class="btn btn-sm btn-primary">Th√™m</button>
            </div>
            <div class="card-body">
              <div class="row g-2 mb-2">
                <div class="col-md-4"><input id="stu_q" class="form-control" placeholder="T√¨m theo m√£/t√™n/email"></div>
                <div class="col-md-3"><select id="stu_class" class="form-select"><option value="">-- L·ªçc theo l·ªõp --</option></select></div>
                <div class="col-md-2"><button id="stu_search_btn" class="btn btn-primary w-100">T√¨m</button></div>
              </div>
              <div id="stu_table">‚Äî</div>
            </div>
          </div>
        </section>

        <section id="page-users" class="page d-none"><div class="card glass"><div class="card-header"><i class="bi bi-person-gear me-2"></i>Ng∆∞·ªùi d√πng</div><div class="card-body"><div id="user_table">‚Äî</div></div></div></section>
        <section id="page-configs" class="page d-none"><div class="card glass"><div class="card-header"><i class="bi bi-gear-wide-connected me-2"></i>C·∫•u h√¨nh</div><div class="card-body"><div id="cfg_table">‚Äî</div></div></div></section>
        <section id="page-warnings" class="page d-none"><div class="card glass"><div class="card-header d-flex justify-content-between align-items-center"><span><i class="bi bi-exclamation-triangle me-2"></i>C·∫£nh b√°o h·ªçc v·ª•</span><button id="warn_scan_btn" class="btn btn-sm btn-primary">Qu√©t c·∫£nh b√°o</button></div><div class="card-body"><div class="row g-3"><div class="col-lg-5"><div class="card h-100"><div class="card-header">Rule</div><div class="card-body" id="warn_rules">‚Äî</div></div></div><div class="col-lg-7"><div class="card h-100"><div class="card-header">Danh s√°ch c·∫£nh b√°o</div><div class="card-body" id="warn_cases">‚Äî</div></div></div></div></div></div></section>
        <section id="page-logs" class="page d-none"><div class="card glass"><div class="card-header"><i class="bi bi-clock-history me-2"></i>Nh·∫≠t k√Ω</div><div class="card-body" id="log_table">‚Äî</div></div></section>
        <section id="page-catalog" class="page d-none">
          <div class="row g-3">
            <div class="col-lg-4"><div class="card h-100 glass"><div class="card-header d-flex justify-content-between align-items-center"><span>Ng√†nh</span><button id="btnAddMajor" class="btn btn-sm btn-primary">Th√™m</button></div><div class="card-body" id="cat_majors">‚Äî</div></div></div>
            <div class="col-lg-4"><div class="card h-100 glass"><div class="card-header d-flex justify-content-between align-items-center"><span>L·ªõp</span><button id="btnAddClass" class="btn btn-sm btn-primary">Th√™m</button></div><div class="card-body" id="cat_classes">‚Äî</div></div></div>
            <div class="col-lg-4"><div class="card h-100 glass"><div class="card-header d-flex justify-content-between align-items-center"><span>H·ªçc ph·∫ßn</span><button id="btnAddCourse" class="btn btn-sm btn-primary">Th√™m</button></div><div class="card-body" id="cat_courses">‚Äî</div></div></div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="toast" class="toast align-items-center text-bg-info border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">Th√¥ng b√°o</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="ƒê√≥ng"></button>
      </div>
    </div>
  </div>

  <!-- Modals: Login -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">ƒêƒÉng nh·∫≠p</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Email / Username</label>
            <input id="loginEmail" class="form-control" autocomplete="username">
          </div>
          <div class="mb-3">
            <label class="form-label">M·∫≠t kh·∫©u</label>
            <input id="loginPass" type="password" class="form-control" autocomplete="current-password">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">H·ªßy</button>
          <button id="btnLoginSubmit" type="button" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Chi ti·∫øt sinh vi√™n -->
  <div class="modal fade" id="stuDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Chi ti·∫øt sinh vi√™n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        <div class="modal-body"><!-- JS s·∫Ω render n·ªôi dung --></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Th√™m/S·ª≠a sinh vi√™n -->
  <div class="modal fade" id="studentEditModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Sinh vi√™n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">M√£ SV</label>
            <input id="sv_ma" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">H·ªç t√™n</label>
            <input id="sv_ten" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">L·ªõp</label>
            <input id="sv_lop" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Email</label>
            <input id="sv_email" class="form-control" type="email">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">H·ªßy</button>
          <button id="sv_save_btn" type="button" class="btn btn-primary">L∆∞u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Danh m·ª•c (Ng√†nh/L·ªõp/H·ªçc ph·∫ßn) -->
  <div class="modal fade" id="catalogEditModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Danh m·ª•c</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        <div class="modal-body">
          <div id="cat_form" class="row g-2"><!-- JS s·∫Ω b∆°m input ƒë·ªông --></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">H·ªßy</button>
          <button id="cat_save_btn" type="button" class="btn btn-primary">L∆∞u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('admin_ui.static', filename='javascript.js') }}"></script>
</body>
</html>
